# Linknote 后端运行指南

本文档帮助你在本地快速启动并验证 Linknote 项目的两个后端服务（Java Spring Boot 与 Python Flask）。可按需选择基础问答（默认）或启用 AI 问答扩展。

---

## 1. 项目结构概览

```
Linknote-master/
├─ src/                          # Spring Boot Java 后端
├─ python_back/                  # Python Flask 后端
│  ├─ app_simple.py              # 默认：简化版问答（无需 AI）
│  ├─ app.py                     # 完整版：RAG + Ollama（需额外配置）
│  ├─ app_deepseek_api.py        # 备选：DeepSeek 云端 API（需自备 Key）
│  └─ requirements.txt           # Python 全量依赖列表
├─ test_frontend.html            # 简易测试页面（可直接打开）
└─ 启动完整版后端.bat             # 启动 app.py 的辅助脚本
```

---

## 2. 环境准备

| 组件             | 说明                                   | 验证命令或说明                    |
|------------------|----------------------------------------|-----------------------------------|
| JDK 17+          | Spring Boot 3.x 需要                   | `java -version`                   |
| Maven Wrapper    | 项目已内置 `.mvnw` / `.mvnw.cmd`       | 无需额外安装                      |
| Python 3.11+     | Flask 后端使用                         | `python --version`                |
| pip              | Python 包管理工具                      | `python -m pip --version`         |
| MySQL 8.x        | 本地数据库（默认账号 root/Gkm104021）  | `mysql -u root -p`                |

> 若数据库密码不同，请同步修改以下文件：
`src/main/resources/application.properties`  
`python_back/app_simple.py`。

### 2.1 初始化 MySQL 数据库

```sql
CREATE DATABASE linknote CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

默认连接信息：
- Host: `localhost`
- Port: `3306`
- Database: `linknote`
- User: `root`
- Password: `123456`（请按需调整）

---

## 3. 启动流程（推荐顺序）

### 3.1 启动 Spring Boot 后端（端口 8080）

```powershell
# 在项目根目录执行
.\mvnw.cmd spring-boot:run
```

- 首次启动会自动下载依赖，请保持联网。
- 控制台出现 `Started LinknoteApplication` 即表示启动成功。
- 访问 http://localhost:8080/linknote 验证。

### 3.2 启动 Python Flask 后端（端口 5000）

#### ✅ 方式 A：默认简化版（无需 AI）

```powershell
cd python_back
python app_simple.py
```

- 功能：返回固定示例回答，便于联调前端。
- 健康检查： http://localhost:5000/health
- 终端显示 `Starting Flask server on port 5000...` 且无报错表示成功。

#### ⚙️ 方式 B：完整 AI 问答（需额外配置）

1. 安装依赖（建议使用国内镜像）
   ```powershell
   cd python_back
   python -m pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
   ```
2. 选择推理后端：
   - **本地 Ollama**：拉取模型（如 `ollama pull llama3.2:3b`），修改 `app.py` 中模型名并运行 `python app.py`
   - **DeepSeek API**：在 `app_deepseek_api.py` 中使用环境变量 `DEEPSEEK_API_KEY`，运行 `python app_deepseek_api.py`
3. 运行 `启动完整版后端.bat` 可以快捷启动 `app.py`

> 若暂时不启用 AI，可直接使用方式 A。

---

## 4. 前端联调（可选）

- 打开 `test_frontend.html`（双击或拖入浏览器），即可测试两个后端：
  - “检查服务状态”会请求 `/health` 与 `/linknote`
  - “提问”按钮会调用 `POST http://localhost:5000/ask`

> 简化版后端会返回固定文本；完整版/DeepSeek 版本会返回真实回答。

---

## 5. 停止服务

- **Spring Boot**：在运行 Maven 的终端按 `Ctrl + C`
- **Flask**：在运行 Python 的终端按 `Ctrl + C`

---

## 6. 常见问题 & 排障

| 问题描述                                   | 参考解决方案                                                                 |
|--------------------------------------------|------------------------------------------------------------------------------|
| Maven 下载依赖缓慢或失败                   | 配置国内 Maven 镜像；重新执行 `mvnw cmd spring-boot:run`                     |
| Java 启动报 MySQL 时区错误                 | 已在配置中添加 `?serverTimezone=Asia/Shanghai&useSSL=false`                 |
| Flask 启动报缺包                           | 确认执行过 `python -m pip install -r requirements_core.txt` 或 `requirements.txt` |
| Flask 报 Ollama 连接失败                   | 确认 Ollama 服务已运行：`ollama list`                                       |
| AI 回答为空或报错                          | 检查模型名称、API Key、网络状况                                             |
| DeepSeek API 401/429                       | 使用有效 Key，控制调用频率                                                 |

---

## 7. 安全建议

- 避免将真实数据库密码或 API Key 提交到版本控制。
- 推荐使用环境变量或本地配置文件（如 `.env`）管理敏感信息。
- `app_deepseek_api.py` 中的示例 Key 仅供测试，请及时替换或删除。

---

## 8. 快速检查脚本

| 文件                          | 作用                                   |
|-------------------------------|----------------------------------------|
| `检测Ollama.bat`             | 判断 Ollama 是否安装/运行              |
| `启动完整版后端.bat`         | 启动 `python_back/app.py`              |
| `test_frontend.html`         | 浏览器测试页面                         |

---

## 9. 后续可拓展方向

1. **完善 AI 问答**：接入自定义模型、优化分词与检索逻辑
2. **前端整合**：将测试页面功能移植到正式前端项目
3. **容器化部署**：为两个后端编写 Dockerfile 与 docker-compose
4. **日志与监控**：增加访问日志、性能监控、错误告警

---

如需切换不同方案或排查其他问题，可随时联系我协助。祝你开发顺利！💪
